<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>관리자 페이지 - 오마카세미루</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }
        .tab-btn.active {
            border-bottom-color: #16a34a;
            color: #16a34a;
            background-color: #f0fdf4;
        }
        .tab-content.hidden {
            display: none;
        }
        .admin-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        .admin-content {
            filter: blur(10px);
            pointer-events: none;
        }
        #googleLoginBtn svg,
        #googleLoginBtn svg * {
            pointer-events: none;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Firebase Authentication Modal -->
    <div id="authOverlay" class="admin-overlay hidden">
        <div class="bg-white rounded-lg shadow-2xl p-8 max-w-md w-full mx-4">
            <div class="text-center mb-6">
                <h2 class="text-2xl font-black text-gray-800 mb-2">🔒 관리자 인증</h2>
                <p class="text-sm text-gray-600">구글 계정으로 로그인하세요</p>
            </div>

            <div id="loginSection">
                <button id="googleLoginBtn" type="button"
                        class="w-full bg-white border-2 border-gray-300 text-gray-700 font-bold py-3 px-4 rounded-lg hover:bg-gray-50 transition flex items-center justify-center gap-3">
                    <svg width="20" height="20" viewBox="0 0 20 20">
                        <path fill="#4285F4" d="M19.6 10.23c0-.82-.1-1.42-.25-2.05H10v3.72h5.5c-.15.96-.74 2.31-2.04 3.22v2.45h3.16c1.89-1.73 2.98-4.3 2.98-7.34z"/>
                        <path fill="#34A853" d="M13.46 15.13c-.83.59-1.96 1-3.46 1-2.64 0-4.88-1.74-5.68-4.15H1.07v2.52C2.72 17.75 6.09 20 10 20c2.7 0 4.96-.89 6.62-2.42l-3.16-2.45z"/>
                        <path fill="#FBBC05" d="M3.99 10c0-.69.12-1.35.32-1.97V5.51H1.07A9.973 9.973 0 000 10c0 1.61.39 3.14 1.07 4.49l3.24-2.52c-.2-.62-.32-1.28-.32-1.97z"/>
                        <path fill="#EA4335" d="M10 3.88c1.88 0 3.13.81 3.85 1.48l2.84-2.76C14.96.99 12.7 0 10 0 6.09 0 2.72 2.25 1.07 5.51l3.24 2.52C5.12 5.62 7.36 3.88 10 3.88z"/>
                    </svg>
                    Google로 로그인
                </button>

                <p id="authError" class="text-red-600 text-sm mt-4 hidden text-center"></p>
            </div>

            <div id="loadingSection" class="hidden text-center py-4">
                <div class="inline-block animate-spin rounded-full h-8 w-8 border-4 border-green-500 border-t-transparent"></div>
                <p class="mt-2 text-gray-600 text-sm">로그인 중...</p>
            </div>

            <a href="/" class="block text-center text-sm text-gray-500 hover:text-gray-700 mt-6">
                ← 메인 페이지로 돌아가기
            </a>
        </div>
    </div>

    <div id="mainContent" class="admin-content">
    <!-- Header -->
    <header class="bg-gradient-to-r from-green-600 to-emerald-700 text-white shadow-lg">
        <div class="container mx-auto px-4 py-6">
            <div class="flex items-center justify-between">
                <a href="/" class="flex items-center hover:opacity-80 transition">
                    <span class="text-2xl md:text-3xl font-black">⚽ 오마카세미루 - 관리자</span>
                </a>
                <div class="flex gap-4 items-center">
                    <span id="userEmail" class="text-sm hidden"></span>
                    <button id="logoutBtn" class="bg-red-500 text-white px-4 py-2 rounded-lg font-semibold hover:bg-red-600 transition hidden">
                        로그아웃
                    </button>
                    <a href="/" class="bg-white text-green-600 px-4 py-2 rounded-lg font-semibold hover:bg-gray-100 transition">
                        ← 메인으로
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Tab Navigation -->
        <section class="bg-white rounded-lg shadow-md mb-8">
            <div class="flex border-b">
                <button id="tab-products" class="tab-btn active flex-1 px-6 py-4 font-bold text-lg hover:bg-gray-50 transition border-b-4 border-green-600">
                    📦 제품 관리
                </button>
                <button id="tab-offers" class="tab-btn flex-1 px-6 py-4 font-bold text-lg hover:bg-gray-50 transition border-b-4 border-transparent">
                    🏪 판매처 관리
                </button>
                <button id="tab-blackfriday" class="tab-btn flex-1 px-6 py-4 font-bold text-lg hover:bg-gray-50 transition border-b-4 border-transparent">
                    🔥 블프 사이트
                </button>
                <button id="tab-account" class="tab-btn flex-1 px-6 py-4 font-bold text-lg hover:bg-gray-50 transition border-b-4 border-transparent">
                    👤 계정 관리
                </button>
            </div>
        </section>

        <!-- Tab Content: 제품 관리 -->
        <div id="content-products" class="tab-content">
            <!-- Product Management Section -->
            <section class="bg-white rounded-lg shadow-md p-6 mb-8">
                <h2 class="text-2xl font-bold mb-6 text-gray-800">➕ 새 제품 추가</h2>

                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">팀 이름 *</label>
                        <input type="text" id="newProductTeam"
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"
                               placeholder="예: 맨체스터 유나이티드">
                    </div>

                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">키트 유형 *</label>
                        <select id="newProductKitType" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                            <option value="홈킷">홈킷</option>
                            <option value="어웨이킷">어웨이킷</option>
                            <option value="써드킷">써드킷</option>
                            <option value="트레이닝">트레이닝</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">시즌 *</label>
                        <select id="newProductSeason" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                            <option value="25/26">25/26</option>
                            <option value="24/25">24/25</option>
                            <option value="23/24">23/24</option>
                            <option value="22/23">22/23</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">버전 *</label>
                        <select id="newProductVersion" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                            <option value="레플리카">레플리카 (팬 버전)</option>
                            <option value="어센틱">어센틱 (선수 버전)</option>
                        </select>
                    </div>

                    <div class="md:col-span-2">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">제품명 *</label>
                        <input type="text" id="newProductName"
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"
                               placeholder="예: 맨체스터 유나이티드 2024 2025 홈 유니폼 (레플리카)">
                    </div>

                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">모델 코드 *</label>
                        <input type="text" id="newProductModelCode"
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"
                               placeholder="예: JI7428">
                    </div>

                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">이미지 URL *</label>
                        <input type="url" id="newProductImage"
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"
                               placeholder="https://example.com/image.jpg">
                    </div>
                </div>

                <button id="addProductBtn"
                        class="mt-6 w-full bg-green-600 text-white font-bold py-3 rounded-lg hover:bg-green-700 transition">
                    제품 추가
                </button>
            </section>

            <!-- Product List -->
            <section class="bg-white rounded-lg shadow-md p-6 mb-8">
                <h2 class="text-2xl font-bold mb-6 text-gray-800">📋 전체 제품 목록</h2>

                <div class="mb-4 flex gap-4">
                    <input type="text" id="searchProduct"
                           class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"
                           placeholder="제품명, 팀, 모델 코드로 검색...">
                    <select id="filterProductTeam" class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                        <option value="">모든 팀</option>
                    </select>
                </div>

                <div id="productListTable" class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left text-sm font-bold text-gray-700">이미지</th>
                                <th class="px-4 py-3 text-left text-sm font-bold text-gray-700">제품명</th>
                                <th class="px-4 py-3 text-left text-sm font-bold text-gray-700">팀</th>
                                <th class="px-4 py-3 text-left text-sm font-bold text-gray-700">시즌</th>
                                <th class="px-4 py-3 text-left text-sm font-bold text-gray-700">버전</th>
                                <th class="px-4 py-3 text-left text-sm font-bold text-gray-700">모델코드</th>
                                <th class="px-4 py-3 text-center text-sm font-bold text-gray-700">판매처</th>
                                <th class="px-4 py-3 text-center text-sm font-bold text-gray-700">노출</th>
                                <th class="px-4 py-3 text-center text-sm font-bold text-gray-700">관리</th>
                            </tr>
                        </thead>
                        <tbody id="productListBody">
                            <!-- Products will be listed here -->
                        </tbody>
                    </table>
                </div>
            </section>
        </div>

        <!-- Tab Content: 판매처 관리 -->
        <div id="content-offers" class="tab-content hidden">
            <!-- Product Selection -->
        <section class="bg-white rounded-lg shadow-md p-6 mb-8">
            <h2 class="text-2xl font-bold mb-6 text-gray-800">📦 제품 선택</h2>

            <div class="grid md:grid-cols-3 gap-4 mb-6">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">팀</label>
                    <select id="adminTeamFilter" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                        <option value="">팀 선택</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">시즌</label>
                    <select id="adminSeasonFilter" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                        <option value="">시즌 선택</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">키트 유형</label>
                    <select id="adminKitFilter" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                        <option value="">키트 선택</option>
                    </select>
                </div>
            </div>

            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">제품</label>
                <select id="productSelect" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                    <option value="">제품을 선택하세요</option>
                </select>
            </div>

            <div id="selectedProductInfo" class="hidden mt-4 p-4 bg-gray-50 rounded-lg">
                <div class="flex items-center gap-4">
                    <img id="selectedProductImage" src="" alt="" class="w-24 h-24 object-cover rounded-lg">
                    <div>
                        <p class="font-bold text-lg" id="selectedProductName"></p>
                        <p class="text-sm text-gray-600" id="selectedProductCode"></p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Current Exchange Rates -->
        <section class="bg-blue-50 border-2 border-blue-200 rounded-lg p-6 mb-8">
            <h2 class="text-xl font-bold mb-4 text-blue-900 flex items-center">
                💱 현재 환율 (실시간)
                <button id="refreshRates" class="ml-4 text-sm bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700 transition">
                    새로고침
                </button>
            </h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4" id="exchangeRates">
                <div class="bg-white p-3 rounded-lg shadow">
                    <p class="text-xs text-gray-600">USD (미국 달러)</p>
                    <p class="text-lg font-bold text-gray-900" id="rate-USD">로딩 중...</p>
                </div>
                <div class="bg-white p-3 rounded-lg shadow">
                    <p class="text-xs text-gray-600">EUR (유럽 유로)</p>
                    <p class="text-lg font-bold text-gray-900" id="rate-EUR">로딩 중...</p>
                </div>
                <div class="bg-white p-3 rounded-lg shadow">
                    <p class="text-xs text-gray-600">GBP (영국 파운드)</p>
                    <p class="text-lg font-bold text-gray-900" id="rate-GBP">로딩 중...</p>
                </div>
                <div class="bg-white p-3 rounded-lg shadow">
                    <p class="text-xs text-gray-600">JPY (일본 100엔)</p>
                    <p class="text-lg font-bold text-gray-900" id="rate-JPY">로딩 중...</p>
                </div>
            </div>
            <p class="text-xs text-gray-600 mt-3">
                * 네이버 증권 실시간 환율 기준
                <a href="https://m.stock.naver.com/marketindex/home/exchangeRate/exchange#exchange"
                   target="_blank"
                   class="text-blue-600 hover:underline ml-2">
                    (환율 확인하기 →)
                </a>
            </p>
        </section>

        <!-- Offer Management -->
        <section class="bg-white rounded-lg shadow-md p-6 mb-8">
            <h2 class="text-2xl font-bold mb-6 text-gray-800">🏪 판매처 관리</h2>

            <!-- Add New Offer Form -->
            <div class="bg-green-50 border-2 border-green-200 rounded-lg p-6 mb-6">
                <h3 class="text-lg font-bold mb-4 text-green-900">➕ 판매처 추가</h3>

                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">판매처 이름 *</label>
                        <input type="text" id="newSiteName"
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"
                               placeholder="예: 나이키 코리아">
                    </div>

                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">통화 *</label>
                        <select id="newCurrency" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                            <option value="KRW">KRW (원화)</option>
                            <option value="USD">USD (달러)</option>
                            <option value="EUR">EUR (유로)</option>
                            <option value="GBP">GBP (파운드)</option>
                            <option value="JPY">JPY (엔)</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">정가 *</label>
                        <div class="relative">
                            <input type="number" id="newRegularPrice"
                                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"
                                   placeholder="100000" step="0.01">
                            <span id="regularPriceKRW" class="absolute right-3 top-2 text-xs text-gray-500"></span>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">판매가 *</label>
                        <div class="relative">
                            <input type="number" id="newSalePrice"
                                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"
                                   placeholder="80000" step="0.01">
                            <span id="salePriceKRW" class="absolute right-3 top-2 text-xs text-gray-500"></span>
                        </div>
                    </div>

                    <div class="md:col-span-2">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">구매 링크 *</label>
                        <input type="url" id="newAffiliateLink"
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"
                               placeholder="https://www.example.com/product">
                    </div>
                </div>

                <div class="mt-4 p-4 bg-white rounded-lg border border-gray-200">
                    <p class="text-sm font-semibold text-gray-700 mb-2">할인율: <span id="calculatedDiscount" class="text-lg text-red-600">0%</span></p>
                    <p class="text-xs text-gray-500">* 할인율은 (정가 - 판매가) / 정가 × 100으로 자동 계산됩니다</p>
                </div>

                <button id="addOfferBtn"
                        class="mt-4 w-full bg-green-600 text-white font-bold py-3 rounded-lg hover:bg-green-700 transition disabled:bg-gray-400 disabled:cursor-not-allowed">
                    판매처 추가
                </button>
            </div>

            <!-- Current Offers List -->
            <div>
                <h3 class="text-lg font-bold mb-4 text-gray-900">📋 현재 판매처 목록</h3>
                <div id="offersList" class="space-y-3">
                    <p class="text-gray-500 text-center py-8">제품을 먼저 선택해주세요</p>
                </div>
            </div>
        </section>

            <!-- Save Changes -->
            <section class="bg-white rounded-lg shadow-md p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-lg font-bold text-gray-900">변경사항 저장</h3>
                        <p class="text-sm text-gray-600">변경된 내용을 data.js 파일에 저장합니다</p>
                    </div>
                    <button id="saveChangesBtn"
                            class="bg-blue-600 text-white font-bold px-8 py-3 rounded-lg hover:bg-blue-700 transition disabled:bg-gray-400">
                        💾 저장하기
                    </button>
                </div>
            </section>
        </div>

        <!-- Tab Content: 블프 사이트 관리 -->
        <div id="content-blackfriday" class="tab-content hidden">
            <!-- Black Friday Sites List -->
            <section class="bg-white rounded-lg shadow-md p-6 mb-8">
                <h2 class="text-2xl font-bold mb-6 text-gray-800">🔥 블프 세일 사이트 목록</h2>

                <div id="blackFridaySitesList" class="space-y-4">
                    <!-- 블프 사이트 카드가 여기에 렌더링됩니다 -->
                </div>
            </section>

            <!-- Save Changes -->
            <section class="bg-white rounded-lg shadow-md p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-lg font-bold text-gray-900">변경사항 저장</h3>
                        <p class="text-sm text-gray-600">변경된 내용을 data.js 파일에 저장합니다</p>
                    </div>
                    <button id="saveBFChangesBtn"
                            class="bg-blue-600 text-white font-bold px-8 py-3 rounded-lg hover:bg-blue-700 transition disabled:bg-gray-400">
                        💾 저장하기
                    </button>
                </div>
            </section>
        </div>

        <!-- Tab Content: 계정 관리 -->
        <div id="content-account" class="tab-content hidden">
            <!-- Firebase 초기 데이터 업로드 -->
            <section class="bg-white rounded-lg shadow-md p-6 mb-8">
                <h2 class="text-2xl font-bold mb-4 text-gray-800">🔥 Firebase 초기 설정</h2>
                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-4">
                    <p class="text-sm text-yellow-800">
                        ⚠️ <strong>최초 1회만 실행:</strong> data.js의 모든 데이터를 Firebase에 업로드합니다.<br>
                        기존 Firebase 데이터가 있다면 덮어씌워지니 주의하세요!
                    </p>
                </div>
                <button onclick="uploadInitialDataToFirebase()"
                        class="bg-orange-600 text-white font-bold px-6 py-3 rounded-lg hover:bg-orange-700 transition">
                    🚀 초기 데이터 업로드
                </button>
            </section>

            <!-- Current Account Info -->
            <section class="bg-white rounded-lg shadow-md p-6 mb-8">
                <h2 class="text-2xl font-bold mb-6 text-gray-800">👤 현재 계정 정보</h2>
                <div class="bg-gray-50 rounded-lg p-6">
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">로그인 이메일</label>
                            <input type="text" id="currentUsername" readonly
                                   class="w-full px-4 py-2 bg-gray-100 border border-gray-300 rounded-lg text-gray-700"
                                   value="Firebase 계정">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">마지막 로그인</label>
                            <input type="text" id="lastLogin" readonly
                                   class="w-full px-4 py-2 bg-gray-100 border border-gray-300 rounded-lg text-gray-700"
                                   value="-">
                        </div>
                    </div>
                </div>
            </section>

            <!-- Firebase Info -->
            <section class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-2xl font-bold mb-6 text-gray-800">🔐 보안 인증</h2>

                <div class="bg-green-50 border-2 border-green-200 rounded-lg p-6 mb-6">
                    <h3 class="font-bold text-green-900 mb-2">✅ Firebase Authentication 적용됨</h3>
                    <p class="text-sm text-green-800 mb-3">
                        이 사이트는 Google Firebase를 통해 보안 인증을 사용합니다.
                    </p>
                    <ul class="text-sm text-green-800 space-y-2">
                        <li>✓ 비밀번호가 소스코드에 노출되지 않습니다</li>
                        <li>✓ 구글 계정으로 안전하게 로그인합니다</li>
                        <li>✓ 허용된 관리자만 접근할 수 있습니다</li>
                        <li>✓ 모든 브라우저와 기기에서 동일하게 작동합니다</li>
                    </ul>
                </div>

                <div class="bg-blue-50 border-2 border-blue-200 rounded-lg p-4">
                    <h3 class="font-bold text-blue-900 mb-2">📝 계정 관리</h3>
                    <p class="text-sm text-blue-800 mb-3">
                        비밀번호 변경이나 계정 관리는 Google 계정 설정에서 할 수 있습니다.
                    </p>
                    <a href="https://myaccount.google.com/security" target="_blank"
                       class="inline-block bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-blue-700 transition text-sm">
                        Google 계정 설정 열기 →
                    </a>
                </div>
            </section>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8 mt-12">
        <div class="container mx-auto px-4 text-center">
            <p class="text-sm">© 2024 오마카세미루 관리자 페이지</p>
        </div>
    </footer>
    </div> <!-- End of mainContent -->

    <!-- Firebase SDK -->
    <script type="module">
        // Firebase imports - Updated to latest version
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js';
        import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js';
        import { getDatabase, ref, set, get, onValue } from 'https://www.gstatic.com/firebasejs/11.0.2/firebase-database.js';

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBu7tXrbeWjp3h0Xt_mCTp4oswsuGMSGkw",
            authDomain: "omacasemiro-8fd4c.firebaseapp.com",
            databaseURL: "https://omacasemiro-8fd4c-default-rtdb.firebaseio.com",
            projectId: "omacasemiro-8fd4c",
            storageBucket: "omacasemiro-8fd4c.firebasestorage.app",
            messagingSenderId: "322343249421",
            appId: "1:322343249421:web:de70a69176f468d5d05744"
        };

        // Initialize Firebase
        console.log('🔵 Firebase 초기화 시작...');
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const database = getDatabase(app);
        const provider = new GoogleAuthProvider();
        console.log('✅ Firebase 초기화 완료');

        // Make database available globally for admin.js
        window.firebaseDB = database;
        window.firebaseDBRef = ref;
        window.firebaseDBSet = set;
        window.firebaseDBGet = get;
        window.firebaseDBOnValue = onValue;

        // 허용된 관리자 이메일 목록
        const ALLOWED_ADMINS = [
            'junsikyoon@gmail.com',
            'wnstlr1590@gmail.com',  // 메인 관리자 계정
        ];

        // 사용자가 허용된 관리자인지 확인
        function isAllowedAdmin(email) {
            return ALLOWED_ADMINS.includes(email);
        }

        // 로그인 성공 처리
        function handleLoginSuccess(user) {
            document.getElementById('authOverlay').classList.add('hidden');
            document.getElementById('mainContent').classList.remove('admin-content');
            document.getElementById('userEmail').textContent = user.email;
            document.getElementById('userEmail').classList.remove('hidden');
            document.getElementById('logoutBtn').classList.remove('hidden');

            // 마지막 로그인 시간 저장
            localStorage.setItem('lastLogin', new Date().toLocaleString('ko-KR'));
            updateLoginTime();
        }

        // 로그인 실패 처리
        function handleLoginError(message) {
            const errorMsg = document.getElementById('authError');
            const loginSection = document.getElementById('loginSection');
            const loadingSection = document.getElementById('loadingSection');

            loadingSection.classList.add('hidden');
            loginSection.classList.remove('hidden');
            errorMsg.textContent = message;
            errorMsg.classList.remove('hidden');
        }

        // 구글 로그인 함수 (팝업 방식)
        async function handleGoogleLogin(event) {
            event.preventDefault();
            event.stopPropagation();
            event.stopImmediatePropagation();

            console.log('🔵 Google 로그인 버튼 클릭됨 (팝업 방식)');

            // 로딩 상태 표시
            const loginSection = document.getElementById('loginSection');
            const loadingSection = document.getElementById('loadingSection');

            loginSection.classList.add('hidden');
            loadingSection.classList.remove('hidden');

            try {
                console.log('🔵 signInWithPopup 실행 시작...');
                console.log('🔵 Provider 설정:', provider);

                const result = await signInWithPopup(auth, provider);
                console.log('✅ signInWithPopup 성공!');
                console.log('✅ 사용자:', result.user.email);

                // 허용된 관리자인지 확인
                if (!isAllowedAdmin(result.user.email)) {
                    console.log('🔴 허용되지 않은 사용자:', result.user.email);
                    await signOut(auth);
                    loginSection.classList.remove('hidden');
                    loadingSection.classList.add('hidden');
                    handleLoginError(`접근 권한이 없습니다.\n관리자에게 문의하세요.\n(${result.user.email})`);
                } else {
                    console.log('🟢 허용된 사용자! 로그인 성공');
                    // handleLoginSuccess는 onAuthStateChanged에서 처리됨
                }
            } catch (error) {
                console.error('🔴 로그인 에러:', error);
                console.error('🔴 에러 코드:', error.code);
                console.error('🔴 에러 메시지:', error.message);
                loginSection.classList.remove('hidden');
                loadingSection.classList.add('hidden');

                if (error.code === 'auth/popup-closed-by-user') {
                    handleLoginError('로그인이 취소되었습니다.');
                } else if (error.code === 'auth/popup-blocked') {
                    handleLoginError('팝업이 차단되었습니다.\n브라우저 설정에서 팝업을 허용해주세요.');
                } else {
                    handleLoginError('로그인에 실패했습니다.\n다시 시도해주세요.');
                }
            }

            return false;
        }

        // 구글 로그인 버튼 이벤트 등록
        document.addEventListener('DOMContentLoaded', () => {
            const googleLoginBtn = document.getElementById('googleLoginBtn');
            if (googleLoginBtn) {
                // 기존 이벤트 제거
                googleLoginBtn.replaceWith(googleLoginBtn.cloneNode(true));
                const newBtn = document.getElementById('googleLoginBtn');

                // 새 이벤트 등록
                newBtn.addEventListener('click', handleGoogleLogin, { capture: true });
                console.log('✅ Google 로그인 버튼 이벤트 리스너 등록 완료');
            } else {
                console.error('❌ googleLoginBtn 요소를 찾을 수 없습니다!');
            }
        });

        // 팝업 방식에서는 리디렉트 처리 불필요
        console.log('✅ 팝업 방식 로그인 사용 - 리디렉트 처리 생략');

        // DOM 로드 후 초기화
        function initializeAuth() {
            console.log('🟣 initializeAuth 시작');

            // 로그아웃 버튼 이벤트
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', async () => {
                    if (confirm('로그아웃 하시겠습니까?')) {
                        try {
                            console.log('🔵 로그아웃 시작...');
                            await signOut(auth);
                            console.log('✅ 로그아웃 성공');
                            location.reload();
                        } catch (error) {
                            console.error('🔴 로그아웃 에러:', error);
                            alert('로그아웃에 실패했습니다.');
                        }
                    }
                });
                console.log('✅ 로그아웃 버튼 이벤트 등록 완료');
            }

            // 인증 상태 변화 감지
            onAuthStateChanged(auth, (user) => {
                console.log('🟣 onAuthStateChanged 호출됨, user:', user?.email || 'null');
                if (user && isAllowedAdmin(user.email)) {
                    // 로그인 상태이고 허용된 사용자
                    handleLoginSuccess(user);
                } else {
                    // 로그아웃 상태 또는 허용되지 않은 사용자
                    document.getElementById('authOverlay').classList.remove('hidden');
                    document.getElementById('mainContent').classList.add('admin-content');
                    document.getElementById('userEmail').classList.add('hidden');
                    document.getElementById('logoutBtn').classList.add('hidden');
                }
            });

            console.log('✅ initializeAuth 완료');
        }

        // DOMContentLoaded 이벤트로 초기화
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeAuth);
        } else {
            // 이미 로드된 경우 즉시 실행
            initializeAuth();
        }

        // 마지막 로그인 시간 업데이트
        function updateLoginTime() {
            const lastLogin = localStorage.getItem('lastLogin');
            const lastLoginEl = document.getElementById('lastLogin');
            if (lastLogin && lastLoginEl) {
                lastLoginEl.value = lastLogin;
            }
        }

        // 계정 관리 탭 관련 함수들 (Firebase 인증에서는 사용 안 함)
        function changePassword() {
            alert('Firebase 인증을 사용 중입니다.\n비밀번호는 Google 계정 설정에서 변경하세요.');
        }

        function resetCredentials() {
            alert('Firebase 인증을 사용 중입니다.\n계정 관리는 Google 계정 설정에서 가능합니다.');
        }

        // 전역으로 함수 노출 (다른 스크립트에서 사용)
        window.changePassword = changePassword;
        window.resetCredentials = resetCredentials;
    </script>

    <script src="js/data.js?v=2"></script>
    <script src="js/admin.js"></script>
</body>
</html>
